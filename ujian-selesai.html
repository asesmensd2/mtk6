<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ujian Selesai</title>
    <script src="questions.js"></script>
    <style type="text/css">@font-face {font-family:Poppins;font-style:normal;font-weight:400;src:url(/cf-fonts/s/poppins/5.0.11/devanagari/400/normal.woff2);unicode-range:U+0900-097F,U+1CD0-1CF9,U+200C-200D,U+20A8,U+20B9,U+25CC,U+A830-A839,U+A8E0-A8FF;font-display:swap;}@font-face {font-family:Poppins;font-style:normal;font-weight:400;src:url(/cf-fonts/s/poppins/5.0.11/latin-ext/400/normal.woff2);unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF;font-display:swap;}@font-face {font-family:Poppins;font-style:normal;font-weight:400;src:url(/cf-fonts/s/poppins/5.0.11/latin/400/normal.woff2);unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;font-display:swap;}</style>
    <style type="text/css">@font-face {font-family:Roboto Condensed;font-style:normal;font-weight:100 900;src:url(/cf-fonts/v/roboto-condensed/5.0.14/greek/wght/normal.woff2);unicode-range:U+0370-03FF;font-display:swap;}@font-face {font-family:Roboto Condensed;font-style:normal;font-weight:100 900;src:url(/cf-fonts/v/roboto-condensed/5.0.14/cyrillic-ext/wght/normal.woff2);unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F;font-display:swap;}@font-face {font-family:Roboto Condensed;font-style:normal;font-weight:100 900;src:url(/cf-fonts/v/roboto-condensed/5.0.14/latin/wght/normal.woff2);unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;font-display:swap;}@font-face {font-family:Roboto Condensed;font-style:normal;font-weight:100 900;src:url(/cf-fonts/v/roboto-condensed/5.0.14/vietnamese/wght/normal.woff2);unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB;font-display:swap;}@font-face {font-family:Roboto Condensed;font-style:normal;font-weight:100 900;src:url(/cf-fonts/v/roboto-condensed/5.0.14/greek-ext/wght/normal.woff2);unicode-range:U+1F00-1FFF;font-display:swap;}@font-face {font-family:Roboto Condensed;font-style:normal;font-weight:100 900;src:url(/cf-fonts/v/roboto-condensed/5.0.14/cyrillic/wght/normal.woff2);unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116;font-display:swap;}@font-face {font-family:Roboto Condensed;font-style:normal;font-weight:100 900;src:url(/cf-fonts/v/roboto-condensed/5.0.14/latin-ext/wght/normal.woff2);unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF;font-display:swap;}@font-face {font-family:Roboto Condensed;font-style:italic;font-weight:100 900;src:url(/cf-fonts/v/roboto-condensed/5.0.14/greek/wght/italic.woff2);unicode-range:U+0370-03FF;font-display:swap;}@font-face {font-family:Roboto Condensed;font-style:italic;font-weight:100 900;src:url(/cf-fonts/v/roboto-condensed/5.0.14/greek-ext/wght/italic.woff2);unicode-range:U+1F00-1FFF;font-display:swap;}@font-face {font-family:Roboto Condensed;font-style:italic;font-weight:100 900;src:url(/cf-fonts/v/roboto-condensed/5.0.14/cyrillic/wght/italic.woff2);unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116;font-display:swap;}@font-face {font-family:Roboto Condensed;font-style:italic;font-weight:100 900;src:url(/cf-fonts/v/roboto-condensed/5.0.14/vietnamese/wght/italic.woff2);unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB;font-display:swap;}@font-face {font-family:Roboto Condensed;font-style:italic;font-weight:100 900;src:url(/cf-fonts/v/roboto-condensed/5.0.14/latin/wght/italic.woff2);unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;font-display:swap;}@font-face {font-family:Roboto Condensed;font-style:italic;font-weight:100 900;src:url(/cf-fonts/v/roboto-condensed/5.0.14/latin-ext/wght/italic.woff2);unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF;font-display:swap;}@font-face {font-family:Roboto Condensed;font-style:italic;font-weight:100 900;src:url(/cf-fonts/v/roboto-condensed/5.0.14/cyrillic-ext/wght/italic.woff2);unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F;font-display:swap;}</style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'poppins': ['Poppins', 'sans-serif'],
                        'condensed': ['"Roboto Condensed"', 'sans-serif'],
                        'arial': ['Arial', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
        /* Custom CSS untuk tabel responsif */
        .responsive-table {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        @media (max-width: 640px) {
            .responsive-table table {
                display: block;
                overflow-x: auto;
                white-space: nowrap;
            }
            .responsive-table th,
            .responsive-table td {
                min-width: 80px;
                padding: 8px;
                font-size: 12px;
            }
            .responsive-table thead {
                display: block;
                float: left;
            }
            .responsive-table tbody {
                display: block;
                width: 100%;
            }
            .responsive-table tr {
                display: flex;
                flex-direction: column;
                margin-bottom: 10px;
            }
            .responsive-table td {
                display: block;
                text-align: left;
            }
            .responsive-table td:before {
                content: attr(data-label);
                font-weight: bold;
                margin-right: 10px;
            }
        }
        /* Custom CSS untuk pop-up */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            animation: fadeInModal 0.3s ease-out;
        }
        @keyframes fadeInModal {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
        .modal-content input {
            width: 80%;
            padding: 8px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-family: Arial, sans-serif;
        }
        .modal-content button {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .btn-submit {
            background-color: #4CAF50;
            color: white;
        }
        .btn-cancel {
            background-color: #f44336;
            color: white;
        }
    </style>
</head>
<body class="bg-gray-100 font-condensed">
    <div id="root"></div>
    <div id="fallback" class="text-center text-red-600 font-poppins">Jika halaman kosong, periksa konsol browser (F12) untuk error.</div>

    <script type="text/babel">
    function UjianSelesai() {
        const [showModal, setShowModal] = React.useState(false);
        const [results, setResults] = React.useState(null);
        const [answerDetails, setAnswerDetails] = React.useState([]);

        React.useEffect(() => {
            try {
                if (typeof questions === 'undefined' || !Array.isArray(questions)) {
                    console.error("questions.js tidak dimuat atau variabel 'questions' tidak ditemukan.");
                    setResults({ nama: 'Error', benar: 'Error', salah: 'Error', nilai: 'Error', error: true });
                    return;
                }

                // 1. Ambil data hasil dari localStorage
                const nama = localStorage.getItem('namaPeserta') || 'Peserta Ujian';
                const benar = localStorage.getItem('jawabanBenar') || '0';
                const salah = localStorage.getItem('jawabanSalah') || '0';
                const nilai = localStorage.getItem('nilaiPeserta') || '0';
                
                // Mengambil array jawaban peserta (ini adalah nilai teks jawaban yang dipilih)
                const answersRaw = localStorage.getItem('answers');
                const userAnswers = answersRaw ? JSON.parse(answersRaw) : [];

                // 2. Hitung Rincian Jawaban dengan Logika Perbandingan yang Tepat
                const details = questions.map((q, index) => {
                    // Mendapatkan NILAI TEKS jawaban peserta dari array userAnswers
                    const userAnswerValue = userAnswers[index];
                    // Jika undefined, null, atau string kosong, anggap tidak dijawab
                    const userAnswerText = userAnswerValue ? userAnswerValue.trim() : ''; 
                    const correctAnswerText = q.jawabanBenar.trim();
                    
                    // PERBANDINGAN status dilakukan menggunakan NILAI TEKS
                    const isCorrect = (userAnswerText === correctAnswerText);
                    const isSkipped = userAnswerText === ''; // Jika string kosong, berarti TIDAK DIJAWAB

                    // Helper untuk mendapatkan label pilihan (A, B, C, D) dari nilai jawabannya
                    const getOptionLabel = (answerValueText, choices) => {
                        if (answerValueText === '') return 'TIDAK DIJAWAB';
                        // Cari index pilihan yang NILAI TEKS-nya sama dengan answerValueText
                        const optionIndex = choices.findIndex(p => p.trim() === answerValueText); 
                        return optionIndex !== -1 ? String.fromCharCode(65 + optionIndex) : 'N/A';
                    };

                    // Konversi NILAI TEKS ke LABEL HURUF (A/B/C/D) untuk ditampilkan
                    const jawabanPesertaLabel = getOptionLabel(userAnswerText, q.pilihan);
                    // Konversi NILAI TEKS kunci jawaban ke LABEL HURUF (A/B/C/D) untuk ditampilkan
                    const jawabanBenarLabel = getOptionLabel(correctAnswerText, q.pilihan);

                    let statusTeks = 'SALAH';
                    if (isCorrect) {
                        statusTeks = 'BENAR';
                    } else if (isSkipped) {
                        statusTeks = 'TIDAK DIJAWAB';
                    }

                    return {
                        nomor: index + 1,
                        soal: q.soal,
                        jawabanPeserta: jawabanPesertaLabel,
                        jawabanBenar: jawabanBenarLabel,
                        status: statusTeks, 
                        isCorrect: isCorrect,
                        isSkipped: isSkipped
                    };
                });
                
                setResults({ nama, benar, salah, nilai, error: false });
                setAnswerDetails(details);

            } catch (e) {
                console.error("Error processing results:", e);
                setResults({ nama: 'Error', benar: 'Error', salah: 'Error', nilai: 'Error', error: true });
            }
        }, []);

        const closeModal = () => setShowModal(false);
        const openModal = () => setShowModal(true);
        
        // LOGIC "Akses Admin" (TIDAK DIUBAH SESUAI PERMINTAAN)
        const handlePasswordSubmit = (e) => {
            e.preventDefault();
            const password = document.getElementById('adminPassword').value;
            const storedPassword = 'admin';
            if (password === storedPassword) {
                window.location.href = 'penilaian-siswa.html';
            } else {
                alert('Password salah!');
            }
        };
        
        const scoreTextColor = results && parseFloat(results.nilai) >= 75 ? 'text-green-600' : 'text-red-600';

        return (
            <div id="root-content" className="p-8 max-w-5xl mx-auto bg-white shadow-xl rounded-lg">
                <h1 className="text-3xl font-bold font-poppins text-blue-800 mb-6 border-b-2 pb-2 text-center">HASIL UJIAN</h1>

                {results && !results.error ? (
                    <div className="space-y-6 text-left">
                        {/* Nama Siswa */}
                        <div className="bg-blue-50 p-4 rounded-lg border-l-4 border-blue-500 shadow-sm">
                            <p className="text-xl font-poppins">Nama Siswa : <span className="font-bold text-gray-800">{results.nama}</span></p>
                        </div>
                        
                        {/* Summary Statistics: Jawaban Benar, Jawaban Salah, Nilai */}
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-6 text-center">
                            <div className="p-5 bg-green-50 border border-green-300 rounded-lg shadow-md">
                                <p className="text-lg font-poppins text-green-700 font-medium">Jawaban Benar</p>
                                <p className="text-4xl font-extrabold text-green-600 mt-1">{results.benar}</p>
                            </div>
                            <div className="p-5 bg-red-50 border border-red-300 rounded-lg shadow-md">
                                <p className="text-lg font-poppins text-red-700 font-medium">Jawaban Salah</p>
                                <p className="text-4xl font-extrabold text-red-600 mt-1">{results.salah}</p>
                            </div>
                            <div className="p-5 bg-blue-50 border border-blue-300 rounded-lg shadow-md">
                                <p className="text-lg font-poppins text-blue-700 font-medium">Nilai</p>
                                <p className={`text-4xl font-extrabold mt-1 ${scoreTextColor}`}>{results.nilai}</p>
                            </div>
                        </div>

                        {/* Rincian Jawaban (Answer Details) */}
                        <div className="mt-8">
                            <h2 className="text-2xl font-bold font-poppins text-gray-800 mb-4 border-b pb-2">Rincian Jawaban</h2>
                            <div className="overflow-x-auto bg-white rounded-lg shadow-lg">
                                <table className="min-w-full divide-y divide-gray-200">
                                    <thead className="bg-gray-100">
                                        <tr>
                                            <th className="px-4 py-3 text-xs font-semibold text-gray-600 uppercase tracking-wider text-center w-12">No.</th>
                                            <th className="px-6 py-3 text-xs font-semibold text-gray-600 uppercase tracking-wider text-left">Soal</th>
                                            <th className="px-4 py-3 text-xs font-semibold text-gray-600 uppercase tracking-wider text-center w-24">Jwb Peserta</th>
                                            <th className="px-4 py-3 text-xs font-semibold text-gray-600 uppercase tracking-wider text-center w-24">Jwb Benar</th>
                                            <th className="px-4 py-3 text-xs font-semibold text-gray-600 uppercase tracking-wider text-center w-20">Status</th>
                                        </tr>
                                    </thead>
                                    <tbody className="bg-white divide-y divide-gray-100">
                                        {answerDetails.map(item => (
                                            <tr key={item.nomor} className={item.isCorrect ? 'hover:bg-green-50' : (item.isSkipped ? 'hover:bg-yellow-50' : 'hover:bg-red-50')}>
                                                <td className="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900 text-center">{item.nomor}</td>
                                                <td className="px-6 py-3 text-sm text-gray-700" dangerouslySetInnerHTML={{ __html: item.soal }}></td>
                                                {/* Kolom Jawaban Peserta */}
                                                <td className={`px-4 py-3 whitespace-nowrap text-sm text-center font-bold 
                                                    ${item.isCorrect ? 'text-green-700' : (item.isSkipped ? 'text-yellow-700' : 'text-red-700')}`}>
                                                    {item.jawabanPeserta}
                                                </td>
                                                {/* Kolom Jawaban Benar */}
                                                <td className="px-4 py-3 whitespace-nowrap text-sm text-center font-bold text-green-600">{item.jawabanBenar}</td>
                                                {/* Kolom Status (BENAR / SALAH / TIDAK DIJAWAB) */}
                                                <td className={`px-4 py-3 whitespace-nowrap text-sm font-bold text-center 
                                                    ${item.isCorrect ? 'text-green-600' : (item.isSkipped ? 'text-yellow-600' : 'text-red-600')}`}>
                                                    {item.status}
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                ) : (
                    <p className="text-xl text-red-500 text-center">Data hasil ujian tidak ditemukan atau terjadi kesalahan. Pastikan file `questions.js` telah dimuat dengan benar.</p>
                )}
                
                {/* AKses Admin Menu (TIDAK DIUBAH) */}
                <div className="mt-10 text-center">
                    <button 
                        className="bg-gray-700 hover:bg-gray-900 text-white font-bold py-3 px-8 rounded-lg transition duration-300 shadow-xl font-poppins text-lg" 
                        onClick={openModal}
                    >
                        Akses Admin
                    </button>
                </div>
                
                {/* Modal for Admin Access - Unchanged */}
                {showModal && (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                        <div className="bg-white p-6 rounded-lg shadow-xl w-11/12 max-w-sm text-center">
                            <h2 className="text-xl font-poppins mb-4">Masukkan Password Admin</h2>
                            <form onSubmit={handlePasswordSubmit}>
                                <input
                                    type="password"
                                    id="adminPassword"
                                    placeholder="Password"
                                    className="w-full p-2 mb-4 border border-gray-300 rounded"
                                />
                                <div className="flex justify-center space-x-2">
                                    <button type="submit" className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded transition duration-300 mr-2">Submit</button>
                                    <button type="button" className="bg-gray-400 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded transition duration-300" onClick={closeModal}>Cancel</button>
                                </div>
                            </form>
                        </div>
                    </div>
                )}
            </div>
        );
    }
    
    // Fallback and Render logic
    const fallback = document.getElementById('fallback');
    if (fallback) fallback.style.display = 'block';

    document.getElementById('fallback').style.display = 'none';
    ReactDOM.render(<UjianSelesai />, document.getElementById('root'));
</script>
    
</body>
</html>